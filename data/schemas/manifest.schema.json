{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://thrift-illustrated.local/schemas/manifest.schema.json",
  "title": "Thrift Illustrated Manifest",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "release_id",
    "generated_at_utc",
    "generated_with",
    "combos"
  ],
  "properties": {
    "schema_version": {
      "const": "1.0.0"
    },
    "release_id": {
      "type": "string",
      "pattern": "^[a-f0-9]{40}$"
    },
    "generated_at_utc": {
      "type": "string",
      "format": "date-time"
    },
    "generated_with": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "ruby_version",
        "bundler_version",
        "thrift_ref",
        "platform"
      ],
      "properties": {
        "ruby_version": {
          "type": "string",
          "minLength": 1
        },
        "bundler_version": {
          "type": "string",
          "minLength": 1
        },
        "thrift_ref": {
          "type": "string",
          "pattern": "^(git:[a-f0-9]{40}|gem:[0-9A-Za-z._+-]+)$"
        },
        "platform": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "combos": {
      "type": "array",
      "minItems": 1,
      "maxItems": 4,
      "items": {
        "$ref": "#/$defs/comboEntry"
      }
    }
  },
  "$defs": {
    "comboId": {
      "type": "string",
      "enum": [
        "binary-buffered",
        "binary-framed",
        "compact-buffered",
        "compact-framed"
      ]
    },
    "comboEntry": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "protocol",
        "transport",
        "file",
        "sha256",
        "bytes",
        "message_count"
      ],
      "properties": {
        "id": {
          "$ref": "#/$defs/comboId"
        },
        "protocol": {
          "type": "string",
          "enum": [
            "binary",
            "compact"
          ]
        },
        "transport": {
          "type": "string",
          "enum": [
            "buffered",
            "framed"
          ]
        },
        "file": {
          "type": "string",
          "pattern": "^(binary-buffered|binary-framed|compact-buffered|compact-framed)\\.json$"
        },
        "sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },
        "bytes": {
          "type": "integer",
          "minimum": 1,
          "maximum": 2097152
        },
        "message_count": {
          "type": "integer",
          "minimum": 1,
          "maximum": 200
        }
      }
    }
  }
}
